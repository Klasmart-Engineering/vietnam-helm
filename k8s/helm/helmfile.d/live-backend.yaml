environments:
  vietnam-alpha:
    values:
      - ../../../env/vietnam-alpha/.env.yaml
  vietnam-beta:
    values:
      - ../../../env/vietnam-beta/.env.yaml
  vietnam-production:
    values:
      - ../../../env/vietnam-production/.env.yaml      
  indonesia-staging:
    values:
      - ../../../env/indonesia-staging/.env.yaml
  indonesia-production:
    values:
      - ../../../env/indonesia-production/.env.yaml
  indonesia-rk-prod:
    values:
      - ../../../env/indonesia-rk-prod/.env.yaml
  indonesia-rk-beta:
    values:
      - ../../../env/indonesia-rk-beta/.env.yaml
      
releases:
  - name: live-backend
    namespace: {{ .Values.k8s_namespace_kidsloop }}
    chart: ../charts/live-backend
    values:
      - replicaCount: {{ .Values.live_backend_replica_count }}
      - provider: {{ .Values.provider }}
      - serviceType: {{ .Values.k8s_service_type }}
      - prometheus_enabled: {{ .Values.helm_prometheus.enabled }}
      - image:
          repository: {{ .Values.live_backend_image_repository }} 
          tag: {{ .Values.live_backend_image_tag }}
      - imagePullSecrets:
          - name: {{ .Values.live_backend_image_pull_secrets }}
      - ingress:
          annotations:
            cert-manager.io/cluster-issuer: "letsencrypt"
          tls:
            - endpoint:
                hosts:
                  - live{{ .Values.kl_domain }}
                secretName: "letsencrypt-live{{ .Values.kl_domain }}"
          hosts:
            - host: live{{ .Values.kl_domain }}
              paths:
                - "/graphql"
      - resources:
          requests:
            cpu: 500m
            memory: 1Gi
          limits:
            cpu: 500m
            memory: 2Gi
      - redisHost: {{ .Values.redis_host }}
      - assessmentEndpoint: https://cms{{ .Values.kl_domain }}/v1/assessments
      - postgresql_host: {{- if eq .Values.provider "gcp" }} "127.0.0.1" {{- else }} {{ .Values.postgresql_host }} {{- end }}
      - postgresql_database: {{ .Values.postgresql_database }}
      - postgresql_username: {{ .Values.postgresql_username }}
      {{- if eq .Values.provider "gcp" }}
      - project: {{ .Values.terraform_project }}
        region: {{ .Values.terraform_region }}
        postgresql_instance: {{ .Values.postgresql_database }}
        liveJwtKey:
          enabled: true
          existingSecretName: live-jwt-credentials
      {{ end }}

